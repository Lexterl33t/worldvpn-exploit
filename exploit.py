"""
================( BrytonL33T )================  
|            CC: @0xBryton1337l33t           |
|                Ake Enable                  |
==============================================
"""

import os
import socketserver
import http.server
import logging
import cgi
import requests
from colorama import Fore, Back, Style



def forwarding_ipaddr(src_ip, idx):
    os.system("netsh int ip add addr "+str(idx)+" "+str(src_ip)+"/32 st=ac sk=tr")

def del_forwarding_ipaddr(src_ip, idx):
    os.system("netsh int ip delete addr "+str(idx)+" "+str(src_ip)+"")
    
class ServerHandler(http.server.SimpleHTTPRequestHandler):

    def authenticate_request(self):
        self.send_response(200)
        self.send_header("Content-type", "text/html")
        self.end_headers()
        self.wfile.write(b'{"auth":"correct","servers": [{"id":1,"ip":"103.73.65.209","location":"Australia S1","icon":"AU"}],"expireDate":"300000-08-12","vpnPackage":"unlimited"}')

    def get_ip(self):
        return requests.get('http://ifconfig.me').text
    
    def send_ip(self):
        self.send_response(200)
        self.send_header("Content-type", "text/html")
        self.end_headers()
        self.wfile.write(bytes(self.get_ip(), encoding="utf-8"))

    def send_ovpn(self, val):
        self.send_response(200)
        self.send_header("Content-type", "application/octet-stream")
        self.end_headers()
        self.wfile.write(val)

    def send_stunnel_certificate(self, cert):
        self.send_response(200)
        self.send_header("Content-type", "application/x-x509-ca-cert")
        self.send_header('ETag', '6012dfe6-b5c')
        self.send_header("Accept-Ranges", "bytes")
        self.end_headers()
        self.wfile.write(cert)

    def do_GET(self):
        #del_forwarding_ipaddr("104.21.10.118", "1")
        #del_forwarding_ipaddr("172.67.131.120", "1")
        if "/one.php" in self.path:
            print(Fore.GREEN, "Successfully authentication")
            print(Style.RESET_ALL)
            self.authenticate_request()
        elif "/ip.php" in self.path:
            print(Fore.GREEN, "Ip sending")
            print(Style.RESET_ALL)
            self.send_ip()
        elif ".ovpn" in self.path:
            print(Fore.GREEN, "OpenVPN configuration initialised")
            print(Style.RESET_ALL)
            self.send_ovpn(bytes(open("australie.ovpn").read(), encoding="utf-8"))
        elif ".pem" in self.path:
            print(Fore.GREEN, "Certification initialised")
            print(Style.RESET_ALL)
            self.send_stunnel_certificate(bytes(open("stunnel.pem").read(), encoding="utf-8"))




forwarding_ipaddr("104.21.10.118", "1")
forwarding_ipaddr("172.67.131.120", "1")
forwarding_ipaddr("78.47.192.207", "1")
Handler = ServerHandler

httpd = socketserver.TCPServer(("", 80), Handler)

print(Fore.BLUE, "serving at port", 80)
print(Style.RESET_ALL)
httpd.serve_forever()
